---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";

type Props = CollectionEntry<"blog">["data"];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
const rawTags = (Astro.props as any)?.tags ?? "";
const tagList: string[] =
	typeof rawTags === "string"
		? rawTags
				.split(",")
				.map((t) => t.trim())
				.filter(Boolean)
		: Array.isArray(rawTags)
			? rawTags
			: [];
---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} image={heroImage ? `/${heroImage}` : undefined} />
	</head>

	<body class="bg-[var(--navy)] text-[var(--slate)] font-sans antialiased">
		<Header />
		<main class="w-full max-w-4xl mx-auto px-4 pt-[110px] pb-12">
			<script type="application/ld+json">
				{JSON.stringify({
					'@context': 'https://schema.org',
					'@type': 'Article',
					'headline': title,
					'description': description,
					'image': heroImage ? `/${heroImage}` : undefined,
					'datePublished': (Astro.props as any).pubDate?.toISOString?.() || undefined,
					'dateModified': (Astro.props as any).updatedDate?.toISOString?.() || undefined,
					'author': {
						'@type': 'Person',
						'name': 'Madhu Sudhan Subedi',
					},
					'publisher': {
						'@type': 'Organization',
						'name': 'Madhu Sudhan Subedi',
						'logo': {
							'@type': 'ImageObject',
							'url': '/apple-touch-icon.png'
						}
					},
					'mainEntityOfPage': {
						'@type': 'WebPage',
						'@id': Astro.url
					}
				})}
			</script>
			<article>
				<div class="w-full mb-8">
					{
						heroImage && (
							<img
								width={1020}
								height={510}
								src={`/${heroImage}`}
								alt={title}
                                class="block mx-auto rounded-xl shadow-[var(--box-shadow)] w-full h-auto"
								loading="lazy"
								decoding="async"
							/>
						)
					}
				</div>
				<div class="w-full max-w-[720px] mx-auto p-4 text-[var(--light-slate)]">
					<div class="text-center mb-4 py-4 leading-none">
						<div class="mb-2 text-[var(--slate)]">
							<FormattedDate date={pubDate} />
							{
								updatedDate && (
									<div class="italic">
										Last updated on{" "}
										<FormattedDate date={updatedDate} />
									</div>
								)
							}
						</div>
						<h1 class="mb-2 text-[var(--lightest-slate)] text-2xl md:text-4xl font-bold">{title}</h1>
						<hr class="border-[var(--lightest-navy)] my-4" />
					</div>
					<div class="prose prose-invert max-w-none prose-a:text-[var(--green)] prose-headings:text-[var(--lightest-slate)] text-[var(--slate)] leading-relaxed prose-img:rounded-xl prose-img:w-full prose-pre:bg-[var(--light-navy)] prose-pre:border prose-pre:border-[var(--lightest-navy)]">
					    <slot />
                    </div>
					{
						tagList.length > 0 && (
							<div class="mt-8 pt-4 border-t border-[var(--lightest-navy)] flex gap-2 flex-wrap items-center" aria-label="Tags">
								<span class="bg-[var(--light-navy)] text-[var(--green)] px-2 py-1 rounded text-xs font-mono">Tags:</span>
								{tagList.map((t) => (
									<a href={`/notes/tag/${t}`} class="bg-[var(--light-navy)] text-[var(--green)] px-2 py-1 rounded text-xs font-mono no-underline hover:underline">
										#{t}
									</a>
								))}
							</div>
						)
					}
				</div>
			</article>
		</main>
		<Footer />
	</body>
</html>
